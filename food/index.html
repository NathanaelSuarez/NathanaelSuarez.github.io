<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Meal Planner</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="main-header">
        <h1>Dynamic Meal Planner</h1>
        <nav class="tab-navigation">
            <button id="tab-btn-inventory" class="tab-link active">1. Inventory</button>
            <button id="tab-btn-planner" class="tab-link">2. Create & View Plan</button>
        </nav>
    </header>

    <main>
        <!-- ============================================================================== -->
        <!-- TAB 1: INVENTORY (Largely unchanged)                                         -->
        <!-- ============================================================================== -->
        <div id="inventory" class="tab-content">
            <div class="container">
                <h2>Manage Your Food Inventory</h2>
                <p>Add, edit, and manage all possible food items here. This list acts as your master database for the planner.</p>
                <div class="flex-container card-container">
                    <div class="card" style="flex:1">
                        <h3>Load Existing JSON</h3>
                        <textarea id="loadArea" rows="8" placeholder="Paste your food JSON array here and click 'Load'"></textarea><br>
                        <button id="loadJsonBtn">Load JSON</button>
                    </div>
                    <div class="card" style="flex:1">
                        <h3>Export Inventory</h3>
                        <button id="exportJsonBtn">Generate JSON</button>
                        <button id="downloadJsonBtn">Download .json</button>
                        <textarea id="exportArea" rows="8" readonly placeholder="Your generated JSON will appear here"></textarea>
                    </div>
                </div>
                <div class="card">
                    <h2 id="formTitle">Add New Food</h2>
                    <form id="foodForm">
                        <div class="form-grid">
                            <div><label>Name<br><input id="name" required></label></div>
                            <div><label>Servings (On-Hand)<br><input id="servings" type="number" value="0" min="0" step="any" required></label></div>
                            <div><label>Calories<br><input id="calories" type="number" min="0" step="any" required></label></div>
                            <div><label>Protein (g)<br><input id="protein" type="number" min="0" step="any" required></label></div>
                            <div><label>Carbs (g)<br><input id="carbs" type="number" min="0" step="any" required></label></div>
                            <div><label>Fiber (g)<br><input id="fiber" type="number" value="0" min="0" step="any" required></label></div>
                            <div><label>Added Sugar (g)<br><input id="addedSugar" type="number" min="0" step="any" required></label></div>
                            <div><label>Saturated Fat (g)<br><input id="saturatedFat" type="number" min="0" step="any" required></label></div>
                            <div><label>Sodium (mg)<br><input id="sodium" type="number" min="0" step="any" required></label></div>
                            <div><label>Expiration<br><input id="expiration" type="date" required></label></div>
                            <div><label>Max Servings / Day<br>
                                <input id="maxPerDay" type="number" value="99" min="1" title="Set a daily consumption limit. Use a high number like 99 for no limit.">
                            </label></div>
                            <div class="shoppable-checkbox"><label>
                                <input id="shoppable" type="checkbox" checked> Shoppable?
                                <small>Uncheck for free/temporary items that shouldn't appear on the shopping list.</small>
                            </label></div>
                        </div><br>
                        <button type="submit" id="submitBtn">Add Food</button>
                        <button type="button" id="clearFormBtn">Clear</button>
                    </form>
                </div>
                <h2>Current Foods</h2>
                <table id="foodTable">
                    <thead><tr><th>Name</th><th>On-Hand</th><th>Cal</th><th>Prot</th><th>Carb</th><th>Fiber</th><th>Expire</th><th>Max/Day</th><th>Shoppable</th><th>Actions</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ============================================================================== -->
        <!-- TAB 2: UNIFIED PLANNER AND DISTRIBUTOR                                       -->
        <!-- ============================================================================== -->
        <div id="planner" class="tab-content" style="display:none;">
            <div class="container">

                <details id="config-section" class="card" open>
                    <summary><h3>Step 1: Configuration & Generation</h3></summary>
                    <div class="config-content">
                        <div class="flex-container">
                            <div style="flex: 2;">
                                <h4>Plan Dates & Strength</h4>
                                <div class="row">
                                    <label>Start Date</label>
                                    <input id="startDate" type="date">
                                </div>
                                <div class="row">
                                    <label>End Date</label>
                                    <input id="endDate" type="date">
                                </div>
                                <div class="row">
                                    <label>Optimization Strength</label>
                                    <!-- **** CHANGED VALUE TO 2000 **** -->
                                    <input id="numGenerations" type="number" value="2000" min="10" max="5000" title="Higher numbers take longer but may yield a better plan. Represents GA Generations.">
                                </div>
                            </div>
                            <div style="flex: 3;">
                                <h4>Daily Average Macro Ranges</h4>
                                <div class="macro-grid">
                                    <div><label class="small">Calories (min/max)</label><div class="input-pair"><input id="calMin" type="number" value="1800"><input id="calMax" type="number" value="2200"></div></div>
                                    <div><label class="small">Carbs (g) (min/max)</label><div class="input-pair"><input id="carbMin" type="number" value="50"><input id="carbMax" type="number" value="400"></div></div>
                                    <div><label class="small">Added Sugar (g) (min/max)</label><div class="input-pair"><input id="addedSugarMin" type="number" value="0"><input id="addedSugarMax" type="number" value="30"></div></div>
                                    <div><label class="small">Protein (g) (min/max)</label><div class="input-pair"><input id="proteinMin" type="number" value="50"><input id="proteinMax" type="number" value="200"></div></div>
                                    <div><label class="small">Fiber (g) (min/max)</label><div class="input-pair"><input id="fiberMin" type="number" value="25"><input id="fiberMax" type="number" value="50"></div></div>
                                    <div><label class="small">Sat. fat (g) (min/max)</label><div class="input-pair"><input id="satMin" type="number" value="0"><input id="satMax" type="number" value="14"></div></div>
                                    <div><label class="small">Sodium (mg) (min/max)</label><div class="input-pair"><input id="sodiumMin" type="number" value="0"><input id="sodiumMax" type="number" value="1600"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="summary" id="warnings"></div>
                        <div class="generate-plan-controls">
                            <label class="shopping-checkbox-label">
                                <input id="allowShopping" type="checkbox" checked>
                                Allow Shopping?
                                <small>Allows the plan to include items not in stock, which will appear on the shopping list.</small>
                            </label>
                            <button id="planBtn" class="primary-action" style="padding: 12px 24px; font-size: 16px;">Generate Plan</button>
                        </div>
                    </div>
                </details>

                <details id="results-section" class="card">
                    <summary><h3>Step 2: Plan Results & Daily Adjustments</h3></summary>
                    <div class="results-content">
                        <div class="results-header">
                            <div>
                                <div id="planSummary">No plan generated yet.</div>
                                <div id="planAveragesContainer" class="plan-averages"></div>
                            </div>
                            <div class="re-optimize-controls">
                                <label for="recalcGenerations">Re-Opt. Strength</label>
                                <input id="recalcGenerations" type="number" value="200" min="10" max="5000">
                                <button id="recalcBtn">Re-Optimize Future</button>
                            </div>
                        </div>

                        <div class="flex-container">
                            <div class="summary-column">
                                <h4>Shopping List</h4>
                                <div id="shoppingListContainer"></div>
                                <h4>Waste Analysis</h4>
                                <div id="wasteList"></div>
                            </div>
                            <div class="plan-grid-column">
                                <div id="plan-grid">
                                    <!-- The daily meal plan grid will be rendered here by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </main>

    <script type="module" src="js/main.js"></script>
</body>
</html>